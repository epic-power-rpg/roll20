/* ------------- Spells ------------*/

.tabcontrol[value="arcane"]~.tab[name="act_arcane"],
.tabcontrol[value="divine"]~.tab[name="act_divine"],
.tabcontrol[value="innate"]~.tab[name="act_innate"] {
  font-weight: bold;
  text-decoration: none;
  background-color: $selected-tab-color;
  color: white;
  margin-bottom: -1px;
  border-bottom: 1px solid transparent;
}

.sectioncontrol[value="arcane"]~div.arcane,
.sectioncontrol[value="divine"]~div.divine,
.sectioncontrol[value="innate"]~div.innate {
  display: block;
}

.spell-tabs {
  border-bottom: solid black 1px;
  margin-bottom: 6px;
  display: flex;
  align-items: center;

  >button[type="action"] {
    border-bottom: 0px;
  }

  >button[type="roll"] {
    margin-bottom: 1px;
  }
}

.spells {
  div[data-groupname] span {
    display: inline-block;
  }

  input[type="text"]:not(.skillname) {
    text-align: center;
  }

  .label {
    color: black;
  }
}

.arcane .skillattribute {
  text-align: right;
  width: 30px;
  margin-bottom: 2px;
}

.spellEP.spellEP.spellEP {
  width: 50px;
  margin-left: 15px;
}

.spellcasttime {
  width: 50px;
}

.spelltype {
  width: 65px;
}

.spellrange {
  width: 40px;
}

.spelltarget {
  width: 60px;
}

.spellduration {
  width: 70px;
}

.spellhasnote.spellhasnote.spellhasnote.spellhasnote {
  width: 12px;
  margin-left: 0px;
  margin-right: 1px;
  margin-bottom: 2px;
}

.isdiscipline[value="1"] {
  ~.skill-roll,
  ~.spellEP,
  ~.spellcasttime,
  ~.spelltype,
  ~.spellrange,
  ~.spelltarget,
  ~.spellduration,
  ~.spellhasnote {
    display: none;
  }

  ~.spellhasnote+span.skillTP {
    // This aligns the `Experience` column when the row is `isdispline`
    margin-left: 448px;
  }
}

.table-header .skill-roll {
  border-width: 0px;
}

.spell-note {
  flex-grow: 1;
  margin-bottom: 1px;
}
.arcane .spell-note {
  margin-left: 40px;
}

/* Avoid space between items in the row */
.spells {
  .table-header {
    display: flex;
    flex-direction: row;
    align-items: flex-end;
  }

  div[data-groupname]>div {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    /* and make rows overlap */
    margin-top: -1px;
  }

  $grid-padding: 2px;
  $grid-column-gap: 2px;

  @mixin spells-header($grid-template) {
    display: grid;
    grid-template-columns: $grid-template;
    column-gap: $grid-column-gap;
    background: #93c6f2;
    padding: $grid-padding;

    > div {
      text-align: center;
      margin: auto;
      font-weight: bold;
      width: 100%;
    }
  }

  @mixin spells-rows($grid-template, $column-count) {
    display: grid;
    grid-template-columns: $grid-template;
    row-gap: 0;
    column-gap: $grid-column-gap;
    background: aliceblue;
    input, input[type=number], textarea, select {
      width: 100%;
      margin-left: unset;
      background-color: white;
    }
    input[type=text] {
      text-align: left;
    }
    input, span, select {
      white-space: nowrap;
    }
    span {
      text-align: center;
      margin: auto 0;
    }
    button, button[type=roll] {
      margin: 0;
    }
    .spell-row.conditional-one {
      // This makes the notes span all columns
      grid-column-start: 1;
      grid-column-end: ($column-count + 1);
    }
  }

  @mixin spells-grid($spell-type, $grid-template, $column-count) {
    .spells-header-grid.#{$spell-type} {
      @include spells-header($grid-template);
    }

    div[data-groupname="repeating_#{$spell-type}"] > div {
      @include spells-rows($grid-template, $column-count);
    }
  }

  $arcane-grid-template:
    // Discipline?
    minmax(0, 1fr)
    // Name
    minmax(0, 4fr)
    // Ability
    minmax(0, 0.75fr)
    // Mod
    minmax(0, 1fr)
    // (Dice)
    minmax(0, 0.5fr)
    // EP
    minmax(0, 1fr)
    // Cast Time
    minmax(0, 1fr)
    // Touch/ Ray/ Missile
    minmax(0, 2fr)
    // Range
    minmax(0, 1fr)
    // Target
    minmax(0, 1fr)
    // Damage/ Duration
    minmax(0, 1.5fr)
    // N(otes)
    minmax(0, 0.5fr)
    // TP
    minmax(0, 0.5fr)
    // CP
    minmax(0, 0.5fr)
    // Exper.
    minmax(0, 1fr)
    // IQ Â±
    minmax(0, 0.5fr)
    // Base
    minmax(0, 1fr);

  @include spells-grid('arcane', $arcane-grid-template, 18);

  $divine-grid-template: 6fr 1fr 1fr 2fr 1fr 1fr 2fr 0.5fr;
  @include spells-grid('divine', $divine-grid-template, 8);

  $innate-grid-template: 6fr 1fr 2fr 3fr 2fr 3fr 2fr 0.5fr 1fr;
  @include spells-grid('innate', $innate-grid-template, 9);
}

.spell-row {
  display: flex;
  flex-direction: row;
  align-items: flex-end;
}